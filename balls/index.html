<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test 1</title>
</head>
<script src="pixi.min.js"></script>
<body>
<script>

    //Aliases
    var Container = PIXI.Container,
        autoDetectRenderer = PIXI.autoDetectRenderer,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        TextureCache = PIXI.utils.TextureCache,
        Texture = PIXI.Texture,
        Sprite = PIXI.Sprite,
        Text = PIXI.Text,
        Graphics = PIXI.Graphics
    //Create a Pixi stage and renderer and add the
    //renderer.view to the DOM
    var h = 512,
        w = 512
    var stage = new Container(),
        renderer = autoDetectRenderer(w, h, { transparent: true })
    document.body.appendChild(renderer.view)
    setup()

    var circle, t, message,
        ballv = 1,
        ballRadius = 16

    function setup() {

        gameScene = new Container()
        stage.addChild(gameScene)

        // ADD  C I R C L E S

        circle = new Graphics()
        circle.lineStyle(2, 0xFF00FF, 1)
        circle.beginFill(0x9966FF, 0.3)
        circle.drawCircle(w/2, h/2, h/2)
        circle.endFill()
        gameScene.addChild(circle)

        circle = new Graphics()
        circle.lineStyle(2, 0xFF00FF, 1)
        circle.beginFill(0x9966FF, 0.3)
        circle.drawCircle(w/2, h/2, h/2*(2/3))
        circle.endFill()
        gameScene.addChild(circle)

        circle = new Graphics()
        circle.lineStyle(2, 0xFF00FF, 1)
        circle.beginFill(0x9966FF, 0.3)
        circle.drawCircle(w/2, h/2, h/2*(1/3))
        circle.endFill()
        gameScene.addChild(circle)


        // Spawn balls by pressing space
//        var space = keyboard(32)
//        space.press = function() {
//            createBall()
//        }

        balls = []

        //Set the game state
        state = play

        //Start the game loop
        gameLoop()
    }

    function createBall() {

        // draw the ball
        var ball = new Graphics()
        ball.lineStyle(2, 0xFF00FF, 1)
        ball.beginFill(0x9966FF, 0.3)
        ball.drawCircle(w/2, h/2, ballRadius)
        ball.endFill()

        // ball's direction angle in radians
        ball.angle = randomInt(0,360) / 57.29578
        ball.vx = Math.cos(ball.angle) * ballv
        ball.vy = Math.sin(ball.angle) * ballv

        ball.interactive = true
        ball.buttonMode = true
        ball.on('pointerdown', onClick)

        // add the ball to the balls array
        balls.push(ball)

        // add the ball to the gameScene
        gameScene.addChild(ball)

        message = new Text(
            "The End!",
            {font: "64px Futura", fill: "white"}
        )
        message.x = 100
        message.y = 100
        message.interactive = true
        message.buttonMode = true
        message.on('pointerdown', onClick)
        gameScene.addChild(message)
    }

    function onClick () {
        message.text = "derp"
    }

    function gameLoop(){

        //Loop this function 60 times per second
        requestAnimationFrame(gameLoop)

        //Update the current game state:
        state()

        //Render the stage
        renderer.render(stage)
    }

    function play() {
        balls.forEach(function (ball) {
            ball.x += ball.vx
            ball.y += ball.vy
            if (Math.pow(ball.y, 2) + Math.pow(ball.x, 2) > Math.pow((h/2)-ballRadius, 2)) {
                ball.vy = -ball.vy
                ball.vx = -ball.vx
            }
        })
        if (t < 60) {
            t += 1
        } else {
            t = 0
            createBall()
        }
    }
    //The `randomInt` helper function (not including max)
    function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min)) + min
    }
    //The `keyboard` helper function
//    function keyboard(keyCode) {
//        var key = {};
//        key.code = keyCode;
//        key.isDown = false;
//        key.isUp = true;
//        key.press = undefined;
//        key.release = undefined;
//        //The `downHandler`
//        key.downHandler = function(event) {
//            if (event.keyCode === key.code) {
//                if (key.isUp && key.press) key.press();
//                key.isDown = true;
//                key.isUp = false;
//            }
//            event.preventDefault();
//        };
//        //The `upHandler`
//        key.upHandler = function(event) {
//            if (event.keyCode === key.code) {
//                if (key.isDown && key.release) key.release();
//                key.isDown = false;
//                key.isUp = true;
//            }
//            event.preventDefault();
//        };
//        //Attach event listeners
//        window.addEventListener(
//            "keydown", key.downHandler.bind(key), false
//        );
//        window.addEventListener(
//            "keyup", key.upHandler.bind(key), false
//        );
//        return key;
//    }

</script>

</body>
</html>